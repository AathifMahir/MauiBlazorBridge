@inject IBridgeConnectivity BridgeConnection
@implements IDisposable

@if (isOnline)
{
    @Online
}
else
{
    @Offline
}



@code {

    [Parameter]
    public RenderFragment? Online { get; set; }

    [Parameter]
    public RenderFragment? Offline { get; set; }

    bool isOnline = false;

    [Parameter]
    public EventCallback<bool> InternetChanged { get; set; }

    protected override void OnInitialized()
    {
        isOnline = BridgeConnection.IsInternetConnected;
        base.OnInitialized();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            BridgeConnection.InternetConnectionChanged += Bridge_OnInternetConnectionChanged;
        }
        base.OnAfterRender(firstRender);
    }

    private void Bridge_OnInternetConnectionChanged(object? sender, bool e)
    {
        if (isOnline == e) return;

        isOnline = e;
        InternetChanged.InvokeAsync(e);
        StateHasChanged();
    }

    public void Dispose()
    {
        BridgeConnection.InternetConnectionChanged -= Bridge_OnInternetConnectionChanged;
    }

}
